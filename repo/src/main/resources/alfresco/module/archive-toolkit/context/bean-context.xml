<?xml version='1.0' encoding='UTF-8'?>
<beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd">
  <bean id="transformer.worker.Pdf2Pdfa" class="org.alfresco.repo.content.transform.RuntimeExecutableContentTransformerWorker">
    <property name="mimetypeService">
      <ref bean="mimetypeService" />
    </property>
    <property name="checkCommand">
      <bean class="org.alfresco.util.exec.RuntimeExec">
        <property name="commandsAndArguments">
          <map>
            <entry key=".*">
              <list>
                <value>${gs.exe}</value>
                <value>--version</value>
              </list>
            </entry>
          </map>
        </property>
        <property name="errorCodes">
          <value>1</value>
        </property>
      </bean>
    </property>
    <property name="transformCommand">
      <bean class="org.alfresco.util.exec.RuntimeExec">
        <property name="commandsAndArguments">
          <map>
            <entry key=".*">
              <list>
                <!-- http://stackoverflow.com/questions/1659147/how-to-use-ghostscript-to-convert-pdf-to-pdf-a-or-pdf-x gs -dPDFA -dBATCH -dNOPAUSE -sProcessColorModel=DeviceCMYK -sDEVICE=pdfwrite -sPDFACompatibilityPolicy=1 -sOutputFile=protokoll-stamma-signerat-2015-pdf-a.pdf protokoll-stamma-signerat-2015.pdf -->
                <value>${gs.exe}</value>
                <value>-dPDFA=1</value>
                <value>-dSAFER</value>
                <value>-dNOOUTERSAVE</value>
                <value>-dBATCH</value>
                <value>-dNOPAUSE</value>
                <value>-sColorConversionStrategy=UseDeviceIndependentColor</value>
                <value>-sProcessColorModel=DeviceCMYK</value>
                <value>-dEmbedAllFonts=true</value>
                <value>-sDEVICE=pdfwrite</value>
                <value>-sPDFACompatibilityPolicy=1</value>
                <value>-sOutputFile=${target}</value>
                <value>${source}</value>
              </list>
            </entry>
          </map>
        </property>
        <property name="errorCodes">
          <value>1</value>
        </property>
      </bean>
    </property>

    <!-- <property name="transformerConfig"> <ref bean="transformerConfig" /> </property> -->
  </bean>

  <bean id="transformer.Pdf2Pdfa" class="org.alfresco.repo.content.transform.ProxyContentTransformer" parent="baseContentTransformer">
    <property name="worker">
      <ref bean="transformer.worker.Pdf2Pdfa" />
    </property>
  </bean>
  <bean id="archive-toolkit-transform-to-pdf" class="org.redpill.alfresco.archive.repo.action.executor.ConvertToPdfActionExecuter" parent="action-executer">
    <property name="dictionaryService" ref="dictionaryService" />
    <property name="nodeService" ref="NodeService" />
    <property name="checkOutCheckInService" ref="CheckOutCheckInService" />
    <property name="contentService" ref="ContentService" />
    <property name="copyService" ref="CopyService" />
    <property name="mimetypeService" ref="mimetypeService" />
    <property name="applicableTypes">
      <list>
        <value>{http://www.alfresco.org/model/content/1.0}content</value>
      </list>
    </property>
  </bean>

</beans>
