<?xml version='1.0' encoding='UTF-8'?>
<beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd">

  <!-- Registration of new model -->
  <bean id="rl.archiveToolkitDictionaryBootstrap" parent="dictionaryModelBootstrap" depends-on="dictionaryBootstrap">
    <property name="models">
      <list>
        <value>alfresco/module/archive-toolkit/model/archiveToolkitModel.xml</value>
      </list>
    </property>
  </bean>
  
  <bean id="rl.archiveToolkitService" class="org.redpill.alfresco.archive.repo.service.ArchiveToolkitServiceImpl">
    <property name="checksumAlgorithm" value="${archiveToolkit.checksum.algorithm}"/>
    <property name="nodeService" ref="NodeService" />
    <property name="contentService" ref="ContentService" />
  </bean>
  
  <bean id="transformer.worker.Pdf2Pdfa" class="org.redpill.alfresco.archive.repo.content.transform.PdfToPdfaContentTransformerWorker">
    <property name="mimetypeService">
      <ref bean="mimetypeService" />
    </property>
    <property name="checkCommand">
      <bean class="org.alfresco.util.exec.RuntimeExec">
        <property name="commandsAndArguments">
          <map>
            <entry key=".*">
              <list>
                <value>${gs.exe}</value>
                <value>--version</value>
              </list>
            </entry>
          </map>
        </property>
        <property name="errorCodes">
          <value>1</value>
        </property>
      </bean>
    </property>
    <!-- 
     <property name="transformCommand">
      <bean class="org.alfresco.util.exec.RuntimeExec">
        <property name="commandsAndArguments">
          <map>
            <entry key=".*">
              <list>
                <value>${gs.exe}</value>
                <value>-dPDFA=1</value>
                <value>-dSAFER</value>
                <value>-dNOOUTERSAVE</value>
                <value>-dBATCH</value>
                <value>-dNOPAUSE</value>
                <value>-sColorConversionStrategy=UseDeviceIndependentColor</value>
                <value>-sProcessColorModel=DeviceCMYK</value>
                <value>-dEmbedAllFonts=true</value>
                <value>-sDEVICE=pdfwrite</value>
                <value>-sPDFACompatibilityPolicy=1</value>
                <value>-sOutputFile=${target}</value>
                <value>${source}</value>
              </list>
            </entry>
          </map>
        </property>
        <property name="errorCodes">
          <value>1</value>
        </property>
      </bean>
    </property>
       -->
<!-- TODO change to this more correct transformation method. Fix path to icc profile in ps-file.-->
   
    <property name="transformCommand">
      <bean class="org.alfresco.util.exec.RuntimeExec">
        <property name="commandsAndArguments">
          <map>
            <entry key=".*">
              <list>
                <value>${gs.exe}</value>
                <value>-dPDFA=1</value>
                <value>-dNOOUTERSAVE</value>
                <value>-sProcessColorModel=DeviceRGB</value>
                <value>-sDEVICE=pdfwrite</value>
                <value>-o</value>
                <value>${target}</value>
                <value>-sPDFACompatibilityPolicy=1</value>
                <value>${pdfa.definition.file}</value>
                <value>${source}</value>
              </list>
            </entry>
          </map>
        </property>
        <property name="errorCodes">
          <value>1</value>
        </property>
      </bean>
    </property>
 
    <!-- <property name="transformerConfig"> <ref bean="transformerConfig" /> </property> -->
    
    <property name="pdfaDefinitionFile" value="${pdfa.definition.file}" />
    <property name="pdfaICCProfileFile" value="${pdfa.iccprofile.file}" />
  </bean>

  <bean id="transformer.Pdf2Pdfa" class="org.alfresco.repo.content.transform.ProxyContentTransformer" parent="baseContentTransformer">
    <property name="worker">
      <ref bean="transformer.worker.Pdf2Pdfa" />
    </property>
  </bean>

  <bean id="archive-toolkit-transform-to-pdf" class="org.redpill.alfresco.archive.repo.action.executor.ConvertToPdfActionExecuter" parent="action-executer">
    <property name="auditComponent" ref="auditComponent" />
    <property name="dictionaryService" ref="dictionaryService" />
    <property name="nodeService" ref="NodeService" />
    <property name="checkOutCheckInService" ref="CheckOutCheckInService" />
    <property name="contentService" ref="ContentService" />
    <property name="copyService" ref="CopyService" />
    <property name="renditionService" ref="RenditionService" />
    <property name="mimetypeService" ref="mimetypeService" />
    <property name="retryingTransactionHelper" ref="retryingTransactionHelper" />
    <property name="fileFolderService" ref="FileFolderService" />
    <property name="applicableTypes">
      <list>
        <value>{http://www.alfresco.org/model/content/1.0}content</value>
      </list>
    </property>
    <property name="archiveToolkitService" ref="rl.archiveToolkitService" />
  </bean>

</beans>
